<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Drupal 8: Search API Solr</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">
		<link rel="stylesheet" href="css/custom.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="sponsor">
			<img src="assets/drupalcamp2017-logo.svg"/><span>Drupal 8: Search API Solr <strong>@TuWebO</strong></span>
		</div>
		<div class="reveal">
			<div class="slides">

				<!-- Cover -->
				<section data-background-transition="slide" data-background="assets/drupalcamp-bg.jpg" class="left">
					<div class="left">
						<img src="assets/drupalcamp2017-logo.svg"/>
					</div>
					<div class="drupalcamp-label-blue left">
						<h1>Search API Solr en Drupal 8</h1>
						<em>Bases prácticas para encontrar lo buscado</em>
					</div>

					<div class="drupalcamp-label-pink left xsmall">
						Agustín Gómez /
						<span class="small">@TuWebO</span>
					</div>

					<div class="drupalcamp-label-blue left xsmall inline-block" style="float:right">
						#DrupalCampEs
					</div>

				</section>

				<!-- Personal presentation -->
				<section>
					<div><img src="assets/intro/agus-foto.jpg" class="profile-photo"></div>
					<h4>Agustín Gómez</h4>
					<div class="xsmall"><em>Desarrollador y Site-builder</em></div>
					<div class="small"><a href="https://twitter.com/tuwebo" target="_blank">@TuWebO</a></div>
					<p class="xsmall"><a href="https://drupal.org/u/tuwebo" target="_blank">drupal.org/u/TuWebO</a></p>
					<img src="assets/metadrop-logo.svg" class="metadrop-logo">
				</section>


				<section class="intro" style="top: 104px; display: block;">
					<p class="xsmall left"><em>Vamos a hablar de:</em></p>
					<ol>
						<li>Breve historia de Search API y Search API Solr</li>
						<li>Elementos de las páginas de búsqueda</li>
						<li>La búsqueda</li>
						<li>Configuración de Search API Solr</li>
						<li>Configuración de Solr</li>
						<li>Ejemplo / Demo</li>
					</ol>
				</section>

				<!-- @section HISTORIA-->
				<section class="chapter-start history">
					<h2>Historia</h2>
				</section>
				<!-- @endsection -->

				<!-- @section BATTLE PLAN -->
				<section class="history.battleplan">
					<h3>Battleplan</h3>
					<p class="small left"><em>"Contrib Search maintainers are committed to make Drupal 8 kick ass with Search API."</em></p>
					<table>
						<tbody>
						<tr>
							<td>
								<p><img src="assets/history/drunkenmonkey-picture.jpg" alt="drunken monkey's picture" title="drunken monkey's picture"></p>
								<p class="fonts6">Thomas Seidl<br><a href="https://www.drupal.org/u/drunken-monkey">@drunken monkey</a></p>
							</td>
							<td>
								<p><img src="assets/history/nickveenhoj-picture.jpg" alt="Nick_vh's picture" title="Nick_vh's picture"></p>
								<p class="fonts6">Nick Veenhof<br><a href="https://www.drupal.org/u/nick_vh">@nick_vh</a></p>
							</td>
						</tr>
						</tbody>
					</table>
				</section>
				<!-- @endsection -->

				<!-- @section PEOPLE -->
				<section class="history.battleplan">
					<h3>Algunos colaboradores ;)</h3>
					<p class="small">
						Markus Kalkbrenner
						Thomas Seidl
						mkalkbrenner
						Andrei Mateescu
						Sascha Grossenbacher
						nickveenhof
						Mattias Michaux
						drunkenmonkey
						git
						Florian Weber
						Nick Veenhof
						berdir
						Christian Spitzlay
						borisson_
						blazey
						chabby
						ekes
						janusman
						jsacksick
						Ismaeil Abouljamal
						Tobias Stoeckler
						<span style="background-color: yellow"><b>TuWebO</b></span>
						darthsteven
						daspeter
						drunken-monkey
						fago
						larowlan
						mollux
						snufkin
						Abouljamal
						Aurelien Navarre
						Hydra
						Monique Szpak
						NiteshP
						Steven Jones
						The Great Git Migration
						andrewbelcher
						andypost
						ayalon
						bdecarne
						cferthorney
						corvus_ch
						cspitzlay
						daeron
						danquah
						dasjo
						deciphered
						derhasi
						dwikoff
						febbraro
						feyp
						guillaumev
						heykarthikwithu
						ianmthomasuk
						izus
						jhedstrom
						jiff
						jlapp
						jonhattan
						jsteggink
						jwilson3
						kenorb
						klausi
						kotnik
						marthinal
						mbovan
						nickvh
						oknate
						pfrenssen
						populist
						prics
						sardara
						sch4lly
						swentel
						thegreat
						umed_singh
					</p>
				</section>
				<!-- @endsection -->

				<!-- @section GOAL -->
				<section class="history.goal">
					<h3>Nuestra meta</h3>
					<table>
						<tr>
							<td style="vertical-align: top"><img src="assets/history/icon-w-drupal8-search-api.png" width="80%"></td>
							<td style="vertical-align: middle">
								<ul>
									<li>Search API como módulo principal</li>
									<li>Search API Solr</li>
									<li>Integrar los demás módulos mejorando funcionlidad</li>
								</ul>
							</td>
						</tr>
					</table>

				</section>
				<!-- @endsection -->

				<!-- @section TIMELINE -->
				<section class="history.timeline">
					<h3>Time line</h3>
					<p class="xsmall">26 Abr 2017 - Official stable release <a href="https://www.drupal.org/project/search_api/releases/8.x-1.0">Search API - 8.x-1.0</a></p>
					<table class="xsmall">
						<tr>
							<th>2017</th>
							<td><a href="https://drunkenmonkey.at/blog/search_api_d8_release">Search API in Drupal 8 is about to be stable!</a></td>
						</tr>
						<tr>
							<th rowspan="2">2016</th>
							<td style="border-bottom: none"><a href="https://www.drupal.org/node/2831801">Add support for extract to Connector API</a><br><span class="small">Integra distintas "configuraciones" en Search API Solr</span></td>
						</tr>
						<tr>
							<td><a href="https://dev.acquia.com/blog/search-strategies-in-drupal-8/battleplan-for-search--solr-in-drupal-8/09/05/2016/10421">Battleplan for Search & Solr in Drupal 8</a><br><span class="small">Acquia invierte esfuerzo para unificar el módulo Search API</span></td>
						</tr>
						<tr>
							<th rowspan="3">2013</th>
							<td style="border-bottom: none"><a href="https://drunkenmonkey.at/blog/search-api-d8-kickoff-in-szeged">Kicking off the Search API D8 port (again) in Szeged</a><br><span class="small">¡Cogemos fuerzas de nuevo!</span></td>
						</tr>
						<tr>
							<td style="border-bottom: none"><a href="https://groups.drupal.org/node/327723">(Solr) Search in Drupal 8</a><br><span class="small">Search del core, Query classes, Index logic...</span></td>
						</tr>
						<tr>
							<td><a href="https://www.drupal.org/node/2044311">Change workflow plugin system</a><br><span class="small">Unify processors and data alterations, datasources, service classes into proper plugins</span></td>
						</tr>
						<tr>
							<th>2012</th>
							<td><a href="https://barcelona2012.drupaldays.org/sessions/drupal-search-and-solr-wizardry">Solr Wizardry at Dev Days Barcelona 2012</a><br><span class="small">Colaboración entre mantenedores</span></td>
						</tr>
					</table>
				</section>
				<!-- @endsection -->

				<!-- @section DONDE ESTAMOS -->
				<section class="history.now">
					<h3>Algunas Mejoras</h3>
					<ul>
						<li>Índices más flexibles en su configuración</li>
						<li>Interfaz para añadir campos a los items</li>
						<li>Multidioma integrado en Search API</li>
						<li>Mayor facilidad para integrar módulos como el <a href="https://www.drupal.org/project/search_api_solr_multilingual">Search API Solr Multilingual</a></li>
						<li>Processors más poderosos</li>
						<li>Muchas estructuras han sido converitdas en Clases</li>
						<li>Muchas funciones helper pasan a ser service classes</li>
						<li>Integración con Tests</li>
					</ul>
				</section>
				<!-- @endsection -->

				<!-- @section CONTRIBUYE -->
				<section class="history.contribute">
					<h3>¡Contribuye!</h3>
					<p>Empieza por la Documentación</p>
					<table class="xsmall">
						<tbody>
						<tr>
							<td style="vertical-align: top"><a href="https://www.drupal.org/docs/7/modules/search-api">
								https://www.drupal.org/docs/7/modules/search-api
							</a><img src="assets/history/drupal7-search-api-documentation.png"  width="100%"/></td>
							<td style="vertical-align: top"><a href="https://www.drupal.org/docs/8/modules/search-api">
								https://www.drupal.org/docs/8/modules/search-api
							</a><img src="assets/history/drupal8-search-api-documentation.png"  width="100%"/>
							</td>
						</tr>
						</tbody>
					</table>
				</section>
				<!-- @endsection -->

				<!-- @section ELEMENTOS DE PÁGINA BUSQUEDA -->
				<section class="metadrop chapter-start page-search">
					<h2>Elementos de una página de búsqueda</h2>
				</section>
				<!-- @endsection -->

				<!-- @section EJEMPLO PÁGINA DE BÚSQUED -->
				<section class="page-search.elements">
					<h4>Facets, filtros, sorts, rangos, resaltado...</h4>
						<img src="assets/busqueda/apachesolr_module_page.jpg" width="70%">
				</section>
				<!-- @endsection -->

				<!-- @section NÓDULOS QUE OFRECEN FUNCIONALIDAD-->
				<section class="page-search.modules">
					<h3>Módulos de Drupal</h3>
					<p class="xxsmall"><a href="https://www.drupal.org/docs/8/modules/search-api/extension-modules">https://www.drupal.org/docs/8/modules/search-api/extension-modules</a></p>
					<table class="small">
						<tr>
							<th>Server backends</th>
							<th>Otros módulos</th>
						</tr>
						<tr>
							<td><a href="https://www.drupal.org/project/search_api_solr">Solr search</a></td>
							<td><a href="https://www.drupal.org/project/flag_search_api">Flag Search API</a></td>
						</tr>
						<tr>
							<td><a href="https://www.drupal.org/project/search_api_solr_multilingual">Multilingual Solr search</a></td>
							<td><a href="https://www.drupal.org/project/search_api_attachments">Search API attachments</a></td>
						</tr>
						<tr>
							<td><a href="https://www.drupal.org/project/search_api_db">Database search</a></td>
							<td><a href="https://www.drupal.org/project/search_api_location">Search API Location</a></td>
						</tr>
						<tr>
							<td><a href="https://www.drupal.org/project/elasticsearch_connector">Elasticsearch Connector</a></td>
							<td><a href="https://www.drupal.org/project/search_api_sorts">Search API sorts</a></td>
						</tr>
						<tr>
							<td><a href="https://www.drupal.org/project/search_api_algolia">Search API Algolia</a></td>
							<td><a href="https://www.drupal.org/project/search_api_autocomplete">Autocomplete</a></td>
						</tr>
						<tr>
							<td></td>
							<td><a href="https://www.drupal.org/project/facets">Facets</a></td>
						</tr>
						<tr>
							<td></td>
							<td><a href="https://www.drupal.org/project/search_api_exclude_entity">Search API Exclude Entity</a></td>
						</tr>
						<tr>
							<td></td>
							<td><a href="https://www.drupal.org/project/search_api_page">Search pages</a></td>
						</tr>
						<tr>
							<td></td>
							<td><strike><a href="https://www.drupal.org/project/flag_search_api">Multi-index searches</a></strike></td>
						</tr>
					</table>
				</section>
				<!-- @endsection -->

				<!-- @section PAGINA NO ELEMENTOS -->
				<section class="page-search.no-elements">
					<h3>Y si... ¿sólo tenemos este elemento?</h3>
					<img src="assets/busqueda/apachesolr_module_page_clear.jpg" width="70%">
				</section>
				<!-- @endsection -->

				<!-- @section PAGINA NO ELEMENTOS -->
				<section class="page-search.tapas-bar-example">
					<h3>¿Qué almacenamos y cómo para ofrecer buenos resutlados?</h3>
					<img src="assets/busqueda/tapas-bar-ejemplo-01.png">
				</section>
				<!-- @endsection -->

				<!-- @section LA BUSQUEDA -->
				<section class="metadrop chapter-start search">
					<h2>La búsqueda</h2>
				</section>
				<!-- @endsection -->

				<!-- @section EQUILIBRIO -->
				<section class="search.balance">
					<h3>Devolver todos los documentos relevantes y nada más</h3>
					<p class="left"><em>Search API Solr y Drupal lo hacen muy bien "Out of the box", pero pequeñas diferencias en la configuración importan.</em></p>
				</section>
				<!-- @endsection -->

				<!-- @section EQUILIBRIO -->
				<section class="search.precision-example">
					<h4>Busca la letra "N"</h4>
					<p class="xsmall">¿En qué filas sale y cuátas veces?</p>
					<div style="font-size: 1.3em;">
						<p style="font-size: 1em">A</p>
						<p style="font-size: 0.9em">A E</p>
						<p style="font-size: 0.8em">C K N</p>
						<p style="font-size: 0.7em">A R F O</p>
						<p style="font-size: 0.6em">V P G X D</p>
						<p style="font-size: 0.5em">R E A F K O</p>
						<p style="font-size: 0.4em">N V K V O A Z</p>
						<p style="font-size: 0.3em">N P H T A N X U</p>
						<p style="font-size: 0.2em">X D F H P T Z A N</p>
						<p style="font-size: 0.1em">F A X T D N H U P Z</p>
					</div>
				</section>
				<!-- @endsection -->

				<!-- @section FULL TEXT -->
				<section class="search.full-text">
					<h3 style="font-variant-caps: all-small-caps">Campos "FullText"</h3>
					<p class="small">Análisis léxico, morfológico y relevancia</p><hr>
					<div>
						<p>"¿Hay huevos fritos con papas?"</p>
						🡓
						<p>"huevos fritos papas patatas"</p>
						🡓
						<table>
							<tr>
								<td>"huev frit pap"</td>
								<td>"huev frit patat"</td>
							</tr>
						</table>
					</div>
				</section>
				<!-- @endsection -->


				<!-- @section SEARCH API SOLR CONFIG-->
				<section class="chapter-start search-api-solr-config">
					<h2>Configuración de Search API Solr</h2>
					<img src="assets/install/config-index-init.png">
				</section>
				<!-- @endsection -->


				<!-- @section Herramientas Diagrama -->
				<section class="search-api-solr-config.install">
					<h3>Instalación</h3>
					<p class="xsmall left">Debes tener instalado un servidor <a href="http://lucene.apache.org/solr/">Solr</a>, el módulo <em>search</em> (/admin/modules) del core desinstalado, módulo Search API Solr instalado (usa <a href="https://www.drupal.org/documentation/install/composer-dependencies">composer</a> para instalarlo porque necesitamos Solarium) y los archivos de configuración añadidos al servidor Solr (/search_api_solr/solr-conf/
						)</p>
					<ol>
						<li>Servidor / Backend / Connector</li>
						<li>Índice / Servidor / Datasources</li>
						<li>Campos del "Item" a indexar</li>
						<li>Procesadores</li>
						<li>Vista para buscar contenido y mostrar resultado</li>
					</ol>
				</section>
				<!-- @endsection -->


				<section class="search-api-solr-config.step-01">
					<p class="xxsmall">Paso 1</p>
					<h4>Server / Backend</h4>
					<img src="assets/install/add-server-custom.png">
				</section>

				<section class="search-api-solr-config.step-02">
					<p class="xxsmall">Paso 2</p>
					<h4>Connector</h4>
					<img src="assets/install/add-server-connector.png">
				</section>

				<section class="search-api-solr-config.step-03">
					<p class="xxsmall">Paso 3</p>
					<h4>Drupal apunta a Solr</h4>
					<table>
						<tr>
							<td class="xsmall featured" style="vertical-align: top;">:8983/solr/#/~cores/tapas_bar<br><img src="assets/install/solr-core-admin.png" width="100%"></td>
							<td class="xsmall featured" style="vertical-align: top;">/admin/config/search/search-api/add-server<br><img src="assets/install/add-server-ip.png" width="100%"></td>
						</tr>
					</table>
				</section>

				<section class="search-api-solr-config.step-04">
					<p class="xxsmall">Paso 4</p>
					<h4>Comprobamos archivos</h4>
					<table>
						<tr>
							<td class="xsmall featured" style="vertical-align: top;">:8983/solr/#/tapas_bar/files<br><img src="assets/install/solr-files-admin.png" width="100%"></td>
							<td class="xsmall featured" style="vertical-align: top;">admin/config/search/search-api/server/experimental_solr_server/files<br><img src="assets/install/add-server-check.png"></td>
						</tr>
					</table>

				</section>


				<section class="search-api-solr-config.step-05">
					<p class="xxsmall">Paso 5</p>
					<h4>Crear índice</h4>
					<img src="assets/install/add-index.png">
				</section>

				<section class="search-api-solr-config.step-06">
					<p class="xxsmall">Paso 6</p>
					<h4>Configurar data source</h4>
					<img src="assets/install/configure-datasource-server.png">
				</section>


				<section class="search-api-solr-config.step-07">
					<p class="xxsmall">Paso 7</p>
					<h4>Guardar y añadir campos</h4>
					<p class="xsmall left">Debemos tener en cuenta las implicaciones que tiene Indexar los "items" inmediatamente. Por un lado implica mayor seguridad ya que los resultados de las búsquedas no muestran elementos desactualizados, por otro puede ser una sobrecarga cuando hacemos operaciones de muchos elementos.</p>
					<img src="assets/install/install-index-options.png">
				</section>


				<section class="search-api-solr-config.step-08">
					<p class="xxsmall">Paso 8</p>
					<h4>Añadir campos al índice</h4>
					<img src="assets/install/add-fields-empty.png">
				</section>

				<section class="search-api-solr-config.step-09">
					<p class="xxsmall">Paso 9</p>
					<h4>Muy resumido</h4>
					<img src="assets/install/nodo-documento.png">
					<div class="xsmall">
						<p class="left">Estamos en un punto intermedio, vamos a decir al índice la información que queremos indexar.</p>
						<p class="left">Esta información viene definida por "propiedades" (property path) y agrupada por los Datasources seleccionados.</p>
						<p class="left">Podemos añadir al índice uno o más campos por cada propiedad.</p>
					</div>
				</section>

				<section class="search-api-solr-config.step-10">
					<p class="xxsmall">Paso 10</p>
					<h4>Campos añadidos</h4>
					<p class="xxsmall left">Seleccionamos tipo Fulltext si queremos poder buscar entre sus palabras y un boost si queremos darle más relevancia.<br><em>@NOTE:</em> Campo títle indexado dos veces (misma propiedad, dos campos a indexar).</p>
					<img src="assets/install/index-fields-added.png" width="80%">
				</section>

				<section class="search-api-solr-config.step-11">
					<p class="xxsmall">Paso 11</p>
					<h4>Comprobar - Módulo Devel</h4>
					<p class="xsmall left">Antes de nada, puedes activar el módulo <a href="https://www.drupal.org/project/devel">Devel</a> y comprobar (en un nodo) cómo se van a mapear los campos que has añadido. Solr usa <em>"{PREFIX}s_*"</em> y <em>"{PREFIX}m_*"</em> en su nomenclatura (por ahora no te preocupes, indica tipo y cardinanlidad del campo).</p>
					<img src="assets/install/devel-node-solr.png" width="60%">
				</section>


				<section id="search-api-solr-config.step-12" class="search-api-solr-config.step-12">
					<p class="xxsmall">Paso 12</p>
					<h4>Configurar Procesadores</h4>
					<p class="xsmall left">Es una de las herramientas más potentes, por ahora vamos a activar los menos posibles. Algunos pueden interferir con "procesadores" de Solr.<br>Por lo general los procesadores añaden "propiedades" o alteran valores de campos (en distintas etapas del proceso).</p>
					<img src="assets/install/index-processors.png" width="60%">
				</section>

				<section class="search-api-solr-config.step-13">
					<p class="xxsmall">Paso 13</p>
					<h4>Indexamos</h4>
					<p class="xsmall left">Search API Solr incluye el módulo <em>search_api_solr_defaults</em>, donde parte de la configuración la tienes hecha, incluyendo una vista por defecto.</p>
					<img src="assets/install/indexing-admin.png" width="100%">
				</section>

				<section class="search-api-solr-config.step-14">
					<p class="xxsmall">Paso 14</p>
					<h4>Añadimos vista</h4>
					<img src="assets/install/add-view.png" width="100%">
				</section>


				<section class="search-api-solr-config.step-15">
					<p class="xxsmall">Paso 15</p>
					<h4>Configuramos vista</h4>
					<p class="xxsmall left">No cacheamos. Añadimos filtro expuesto de "Full text search" y lo configuramos para que no admita menos de dos caracteres y seleccionamos los campos sobre los que queremos buscar. Ordenamos por relevancia DESC (podemos añadir después fecha DESC por ejemplo), configuramos permisos de acceso, filtramos por tipo de contenido y por estado del contenido (publicado o no). Añadimos resumen de resultados en la cabecera y texto cuando no hay resultados.</p>
					<img src="assets/install/views-admin-configuration.png" width="100%">
				</section>

				<section class="search-api-solr-config.step-16">
					<p class="xxsmall">Paso 16</p>
					<h4>Comprobamos</h4>
					<p class="small">Yeahhh!!!!</p>
					<img src="assets/install/view-platos-results-simple.png" width="100%">
				</section>


				<section class="search-api-solr-config.step-17">
					<h4>Demo</h4>
					<p class="small">#fail</p>
					<p class="xxsmall left">Con los procesadores (<a href="#/search-api-solr-config.step-12">Paso 12</a>) por defecto de Search API podemos solucionar este problema, pero vamos a configurar Solr para que lo haga él.<br>Queremos eliminar los signos de interrogación y las palabras comunes como "Hay" o "con". Además queremos añadir "papas" como sinónimo de patatas.</p>
					<img src="assets/install/demo-fail.png" width="90%">
				</section>

				<!-- @section SEARCH API SOLR CONFIG-->
				<section class="chapter-start solr-config">
					<h2>Configuración de Solr</h2>
					<p class="xsmall">Todo el código es experimental, sólo con el propósito de dar un ejemplo. Sólo se está usando para estas diapositivas.</p>
				</section>
				<!-- @endsection -->


				<section class="solr-config.admin-files">
					<h3>Vista de archivos</h3>
					<div class="xxsmall">
						<p class="featured"><em>:8983/solr/#/my_core/files</em></p>
						<table>
							<tr>
								<td style="vertical-align: top">
									<img src="assets/tools/solr-ui-admin-files.png" width="100%" />
								</td>
								<td>
									<dl class="fonts8">
										<dt>Fundamental: README.txt</dt>
										<dd>search_api_solr/README.txt</dd>
										<dt>Copia los archivos de configuración</dt>
										<dd>search_api_solr/solr-conf/VERSION_NUMBER.x</dd>
										<dt>stopwords_es.txt</dt>
										<dd>Añade stopwords</dd>
										<dt>synonyms_es.xml</dt>
										<dd>Añade sinónimos</dd>
										<dt>mapping-ISOLatin1Accent.txt</dt>
										<dd>Añade las entradas correspondientes</dd>
										<dt>schema_extra_types.xml</dt>
										<dd>Configura campos para español o tu caso de uso (o usa <a href="https://www.drupal.org/project/search_api_solr_multilingual">Search API Multilingual Solr Search</a>)</dd>
										<dt>schema_extra_fields.xml</dt>
										<dd>Implementa los campos que has configurado</dd>
									</dl>
								</td>
							</tr>
						</table>
					</div>
				</section>
				<!-- @endsection -->

				<section class="solr-config.intro">
					<h3>Pasos</h3>
					<ol class="small">
						<li>Crear un nuevo tipo de campo en el esquema de Solr</li>
						<li>Añadir sinónimos y stopwords, para que nuestro campo los use a la hora de analizar</li>
						<li>Ver cómo se comporta el campo (por interfaz de Solr)</li>
						<li>Dar de alta el campo en Drupal mediante plugins para que lo reconozca</li>
					</ol>
				</section>

				<section class="solr-config.step-01">
					<p class="xxsmall">Paso 1</p>
					<h4>Nuevo tipo de campo en solr</h4>
					<p class="xsmall">schema_extra_types.xml</p>
					<p class="xxsmall left">Los textos resaltados con extentisón ".txt" son los que puedes "Tunear", sólo tienes que decirle a tu campo dónde están.</p>
					<p class="xxsmall left">Cada filter y tokenizer que ves, es parecido a los procesadores de Search API, por eso no debemos activar muchos procesadores en Drupal, Solr ya procesa el texto de la forma que queramos nosotros.</p>
					<pre><code class="xxsmall" data-trim data-noescape>
&lt;fieldType name=&quot;text_tapas_bar&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&gt;
    &lt;analyzer type=&quot;index&quot;&gt;
        &lt;charFilter class=&quot;solr.MappingCharFilterFactory&quot; <mark>mapping=&quot;mapping-ISOLatin1Accent.txt&quot;</mark>/&gt;
        &lt;tokenizer class=&quot;solr.WhitespaceTokenizerFactory&quot;/&gt;
        &lt;filter class=&quot;solr.SynonymFilterFactory&quot; <mark>synonyms=&quot;lang/synonyms_es.txt&quot;</mark> ignoreCase=&quot;true&quot; expand=&quot;true&quot;/&gt;
        &lt;filter class=&quot;solr.StopFilterFactory&quot; <mark>words=&quot;lang/stopwords_tildes_added_es.txt&quot; format=&quot;snowball&quot;</mark> ignoreCase=&quot;true&quot;/&gt;
        &lt;filter class=&quot;solr.WordDelimiterFilterFactory&quot; generateWordParts=&quot;1&quot; generateNumberParts=&quot;1&quot; splitOnCaseChange=&quot;1&quot; splitOnNumerics=&quot;1&quot; catenateWords=&quot;1&quot; catenateNumbers=&quot;1&quot; catenateAll=&quot;0&quot; protected=&quot;protwords.txt&quot; preserveOriginal=&quot;1&quot;/&gt;
        &lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&gt;
        <mark>&lt;filter class=&quot;solr.SpanishLightStemFilterFactory&quot;/&gt;</mark>
        &lt;filter class=&quot;solr.RemoveDuplicatesTokenFilterFactory&quot;/&gt;
    &lt;/analyzer&gt;
    &lt;/analyzer&gt;
    &lt;analyzer type=&quot;query&quot;&gt;
        &lt;charFilter class=&quot;solr.MappingCharFilterFactory&quot; <mark>mapping=&quot;mapping-ISOLatin1Accent.txt&quot;</mark>/&gt;
        &lt;tokenizer class=&quot;solr.WhitespaceTokenizerFactory&quot;/&gt;
        &lt;!-- Read https://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters#solr.SynonymFilterFactory --&gt;
        &lt;!-- &lt;filter class=&quot;solr.SynonymFilterFactory&quot; <mark>synonyms=&quot;lang/synonyms_es.txt&quot;</mark> ignoreCase=&quot;true&quot; expand=&quot;true&quot;/&gt; --&gt;
        &lt;filter class=&quot;solr.StopFilterFactory&quot; <mark>words=&quot;lang/stopwords_tildes_added_es.txt&quot; format=&quot;snowball&quot;</mark> ignoreCase=&quot;true&quot;/&gt;
        &lt;filter class=&quot;solr.WordDelimiterFilterFactory&quot; generateWordParts=&quot;1&quot; generateNumberParts=&quot;1&quot; splitOnCaseChange=&quot;1&quot; splitOnNumerics=&quot;1&quot; catenateWords=&quot;0&quot; catenateNumbers=&quot;0&quot; catenateAll=&quot;0&quot; protected=&quot;protwords.txt&quot; preserveOriginal=&quot;1&quot;/&gt;
        &lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&gt;
        <mark>&lt;filter class=&quot;solr.SpanishLightStemFilterFactory&quot;/&gt;</mark>
        &lt;filter class=&quot;solr.RemoveDuplicatesTokenFilterFactory&quot;/&gt;
    &lt;/analyzer&gt;
&lt;/fieldType&gt;
						</code></pre>
				</section>

				<section class="solr-config.step-02">
					<p class="xxsmall">Paso 2</p>
					<h4>Crear campos dinámicos asociados a ese tipo</h4>
					<p class="xsmall">schema_extra_fields.xml</p>
					<pre><code class="xxsmall" data-trim data-noescape>
&lt;dynamicField name=&quot;tbars_*&quot; type=&quot;text_tapas_bar&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;false&quot; termVectors=&quot;true&quot;/&gt;
&lt;dynamicField name=&quot;tbarm_*&quot; type=&quot;text_tapas_bar&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot; termVectors=&quot;true&quot;/&gt;
					</code></pre>
					<p class="xsmall left">Estos campos dinámicos van a ser reconocidos por Search API Solr, siempre y cuando tengan la nomenclatura adecuada como vimos antes.</p>
				</section>

				<section class="solr-config.step-03">
					<p class="xxsmall">Paso 3</p>
					<h4>Recargamos el core y comprobamos si aparece nuestro campo</h4>
					<p class="xxsmall featured">:8983/solr/#/tapas_bar/schema</p>
					<img src="assets/install/solr-admin-schema.png" width="70%">
				</section>


				<section class="solr-config.step-04">
					<p class="xxsmall">Paso 4</p>
					<h4>Pequeño análisis de nuestro campo</h4>
          <p class="xxsmall featured">:8983/solr/#/tapas_bar/analysis</p>
					<p class="xsmall">Puedes comprobar directamente en Solr cómo se va a indexar y a buscar tu campo.<br>¡Es muy útil!</p>
					<img src="assets/install/solr-admin-analysis.png" width="80%">
					<img src="assets/install/solr-admin-analysis-02.png" width="50%">
				</section>

				<!-- @section DEMO-->
				<section class="search-api-solr-config.demo">
					<h3>Demo</h3>
					<p>¡Ahora si!</p>
					<img src="assets/install/demo-ok.png">
				</section>
				<!-- @endsection -->


				<!-- @section DEMO-->
				<section class="search-api-solr-config.demo">
					<h3>Implementación en Drupal</h3>
					<p class="xsmall">La hacemos a través de plugins</p>
					<div class="left">
					<p>Crear backend plugin de Solr que reconozca nuestro tipo.</p>
					<p>Crear un plugin data_type para que Drupal pueda operar con él.</p>
					<p>Extra: Ejemplo de processor plugin que crea un campo (propiedad) para indexar.</p>
					</div>
				</section>
				<!-- @endsection -->


				<!-- @section DEMO-->
				<section class="search-api-solr-config.backend">
					<h4>Backend</h4>
					<p class="small left">Probablemente esto no es lo que quieras hacer en producción, pero como ejemplo vale para ver los elementos implicados</p>
					<pre><code class="xxsmall" data-trim data-noescape>
namespace Drupal\tapas_bar_solr\Plugin\search_api\backend;
use Drupal\search_api_solr\Plugin\search_api\backend\SearchApiSolrBackend;
/**
* Experimental Apache Solr backend for search api.
*
* @SearchApiBackend(
*   id = "tapas_bar_solr_backend",
*   label = @Translation("Experimental Tapas Bar Solr backend"),
*   description = @Translation("Index items using a Custom Solr backend.")
* )
*/
class TapasBarSolrServer extends SearchApiSolrBackend {
function supportsDataType($type) {
return parent::supportsDataType($type) | $type == 'text_tapas_bar';
  }
}
</code></pre>
				</section>
				<!-- @endsection -->

				<section class="solr-config.datatype">
					<h4>Damos de alta el "data type" en Drupal</h4>
					<pre><code class="xxsmall" data-trim data-noescape>
namespace Drupal\tapas_bar_solr\Plugin\search_api\data_type;
use Drupal\search_api\DataType\DataTypePluginBase;
/**
 *
 * @SearchApiDataType(
 *   id = &quot;text_tapas_bar&quot;,
 *   label = @Translation(&quot;FullText Tapas Bar&quot;),
 *   description = @Translation(&quot;A text field which takes in account Spanish tapas bar language&quot;),
 *   fallback_type = &quot;text&quot;,
 *   prefix = &quot;tbar&quot;,
 * )
 */
class TapasBarDataType extends DataTypePluginBase {
}</code></pre>
				</section>

				<section class="solr-config.check">
					<h4>Comprobamos que es reconocido</h4>
					<img src="assets/install/index-tbar-fulltext-field.png"><br>
					<img src="assets/install/index-tbar-fulltext-datatype.png" width="100%">
				</section>


				<section class="solr-config.plugin-add-field">
					<h4>Plugin que añade un campo booleano, que puede ser indexado y reconocido por views</h4>
					<p class="xxsmall">Existen funciones para comprobar si el índice es soportado... no están incluidas.</p>
					<pre><code class="xxsmall" data-trim data-noescape>namespace Drupal\tapas_bar_solr\Plugin\search_api\processor;

use Drupal\search_api\Datasource\DatasourceInterface;
use Drupal\search_api\Item\ItemInterface;
use Drupal\search_api\Processor\ProcessorPluginBase;
use Drupal\search_api\Processor\ProcessorProperty;

/**
 * Adds an experimental property to index.
 *
 * hidden = true | Won't show on Processors Tab
 * locked = true | If it shows, it will be "disabled"
 *
 * @SearchApiProcessor(
 *   id = "tapas_add_discount",
 *   label = @Translation("Adds experimental boolean field"),
 *   description = @Translation("Adds experimental boolean field as if it were a discount (tapas bar)."),
 *   stages = {
 *     "add_properties" = 0,
 *   },
 *   locked = true,
 *   hidden = false,
 * )
 */
class AddTapasDiscount extends ProcessorPluginBase {

  /**
   * {@inheritdoc}
   */
  public function getPropertyDefinitions(DatasourceInterface $datasource = NULL) {
    $properties = [];

    if (!$datasource) {
      $definition = [
        'label' => $this->t('Tapas Bar - Add discount fields'),
        'description' => $this->t('Adds a discount boolean field'),
        'type' => 'boolean',
        'processor_id' => $this->getPluginId(),
      ];
      $properties['tapas_discount_field'] = new ProcessorProperty($definition);
    }

    return $properties;
  }

  /**
   * {@inheritdoc}
   */
  public function addFieldValues(ItemInterface $item) {
    $fields = $this->getFieldsHelper()
      ->filterForPropertyPath($item->getFields(), NULL, 'tapas_discount_field');
    foreach ($fields as $field) {
      if (!$field->getDatasourceId()) {
        // Let's map it with an integer and see how it behaves...
        $field->addValue(rand(0,1) == 1);
      }
    }
  }}</code></pre>

				</section>

				<!-- @section DOCUMENTACIÓN -->
				<section class="solr-config.check-proccesor">
					<h4>Comprobamos</h4>
          <img src="assets/install/processor-custom-01.png" width="60%">
          <img src="assets/install/processor-custom-02.png" width="60%">
				</section>
				<!-- @endsection -->

				<!-- @section Cheat sheet Drupal -->
				<section class="docs.cheatsheet.drupal" data-breadcrumb="Docs > Cheat sheet > Drupal">
					<h4>Drupal - Referencias</h4>
					<dl class="xxsmall">
						<dt>Converting a SearchAPI query into a Solr query</dt>
						<dd>SearchApiSolrBackend::search(QueryInterface $query)</dd>
						<dt>alterSearchApiQuery</dt>
						<dd>Allow custom changes before converting a SearchAPI query into a Solr query</dd>
						<dd>hook_search_api_query_alter</dd>
						<dt>preQuery</dt>
						<dd>Allow custom changes before sending a search query to Solr.</dd>
						<dd>hook_search_api_solr_query_alter</dd>
						<dt>alterSolrDocuments</dt>
						<dd>Alter Solr documents before they are sent to Solr for indexing.</dd>
						<dd>hook_search_api_solr_documents_alter</dd>
					</dl>
				</section>
				<!-- @endsection -->

				<!-- @section Cheat sheet Solr -->
				<section class="docs.cheatsheet.solr" data-breadcrumb="Docs > Cheat sheet > Solr">
					<h4>Solr - Referencias</h4>
					<dl class="xxsmall">
						<dt>Apache Solr Reference Guide</dt>
						<dd><a href="https://cwiki.apache.org/confluence/display/solr/Apache+Solr+Reference+Guide">https://cwiki.apache.org/confluence/display/solr/Apache+Solr+Reference+Guide</a></dd>
						<dt>Solr resources</dt>
						<dd><a href="https://lucene.apache.org/solr/resources.html#documentation">https://lucene.apache.org/solr/resources.html#documentation</a></dd>
						<dt>Solarium project</dt>
						<dd><a href="http://www.solarium-project.org">http://www.solarium-project.org</a></dd>
						<dd>Explore the benefits / drawbacks of integrating with the Solarium library (<a href="https://www.drupal.org/node/1351752">Drupal issue</a> )</dd>
						<dt>Lucene vs Solr</dt>
						<dd><a href="http://www.lucenetutorial.com/lucene-vs-solr.html">http://www.lucenetutorial.com/lucene-vs-solr.html</a></dd>
						<dt>What the fq? A short summary of Solr query fields.</dt>
						<dd><a href="https://www.triquanta.nl/blog/what-fq-short-summary-solr-query-fields">https://www.triquanta.nl/blog/what-fq-short-summary-solr-query-fields</a></dd>
						<dt>Analyzers</dt>
						<dd><a href="https://cwiki.apache.org/confluence/display/solr/Analyzers">https://cwiki.apache.org/confluence/display/solr/Analyzers</a></dd>
						<dt>Tokenizers</dt>
						<dd><a href="https://cwiki.apache.org/confluence/display/solr/About+Tokenizers">https://cwiki.apache.org/confluence/display/solr/About+Tokenizers</a></dd>
						<dt>Filters</dt>
						<dd><a href="https://cwiki.apache.org/confluence/display/solr/About+Filters">https://cwiki.apache.org/confluence/display/solr/About+Filters</a></dd>
						<dt>What is term vector in Lucene</dt>
						<dd><a href="http://makble.com/what-is-term-vector-in-lucene">http://makble.com/what-is-term-vector-in-lucene</a></dd>
					</dl>
				</section>
				<!-- @endsection -->

				<!-- @section Cheat sheet Solr -->
				<section class="docs.references" data-breadcrumb="Docs > Referencias">
					<h4>Otras Referencias</h4>
					<dl class="xxsmall">
						<dt>Búsquedas "Full Text"</dt>
						<dd><a href="https://en.wikipedia.org/wiki/Full-text_search">https://en.wikipedia.org/wiki/Full-text_search</a></dd>
						<dd><a href="http://stackoverflow.com/questions/224714/what-is-full-text-search-vs-like">http://stackoverflow.com/questions/224714/what-is-full-text-search-vs-like</a></dd>
					</dl>
				</section>
				<!-- @endsection -->

				<section>
					<h2>¡Muchas gracias!</h2>
          <p>¡A todos los voluntarios!</p>
          <p>¡A la Organización!</p>
          <p>¡A la Asociación Española de Drupal!</p>
          <p>¡A todos vosotros!</p>
					<p class="xsmall featured"><em><a href="https://dev.acquia.com/blog/drupal-8-module-of-the-week/drupal-8-module-of-the-week-search-api/29/03/2016/10201">InMemoriamOfPinkPony.rip</a></em></p>
				</section>



			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
